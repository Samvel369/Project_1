name: ğŸš€ Deploy Flask App to Server

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v3

      - name: ğŸ” SSH & Deploy
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_IP }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_KEY }}
          port: 22
          script: |
            echo "ğŸ“ ĞŸĞµÑ€ĞµÑ…Ğ¾Ğ´ Ğ² Ğ¿Ñ€Ğ¾ĞµĞºÑ‚"
            cd ~/Project_1

            echo "ğŸ”„ ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ ÑĞ¾ÑÑ‚Ğ¾ÑĞ½Ğ¸Ñ"
            git status
            git remote -v

            echo "ğŸ“¦ ĞŸÑƒĞ»Ğ» ĞºĞ¾Ğ´Ğ° Ñ GitHub"
            git pull origin main

            echo "ğŸ§  ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°, Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ¸Ğ»ÑÑ Ğ»Ğ¸ base.html"
            tail -n 10 templates/base.html

            echo "ğŸ ĞĞºÑ‚Ğ¸Ğ²Ğ°Ñ†Ğ¸Ñ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ"
            source venv/bin/activate

            echo "ğŸ“¦ ĞŸĞµÑ€ĞµĞ·Ğ°Ğ¿ÑƒÑĞº Docker"
            docker-compose down
            docker-compose up --build -d

            echo "âœ… Ğ”ĞµĞ¿Ğ»Ğ¾Ğ¹ Ğ·Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½"
